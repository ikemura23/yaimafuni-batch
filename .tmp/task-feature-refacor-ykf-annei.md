# index.jsのコントローラー呼び出し統一タスク

## 概要

index.jsにおけるanneiとykfのコントローラー呼び出し方法を統一し、テスト導入時の保守性と拡張性を向上させるための詳細タスク定義

## タスク一覧

### タスク1: ControllerManagerクラスの作成

**優先度**: 高  
**推定時間**: 2時間

#### チェックリスト

- [x] `src/controllers/`ディレクトリの作成
- [x] `src/controllers/index.js`ファイルの作成
- [x] ControllerManagerクラスの基本構造の実装
- [x] anneiコントローラーの統合
  - [x] list-controller.jsの統合
  - [x] detail-controller.jsの統合
  - [x] time-announce-controller.jsの統合
- [x] ykfコントローラーの統合
  - [x] list-controller.jsの統合
  - [x] detail-controller.jsの統合
  - [x] time-announce-controller.jsの統合
- [x] updateAll()メソッドの実装
- [x] 個別実行メソッドの実装（テスト用）
- [x] エラーハンドリングの実装

#### 技術要件

- クラス名: `ControllerManager`
- メソッド: `updateAll()`, `updateAnneiList()`, `updateYkfList()`など
- エラーハンドリング: try-catch + 適切なログ出力
- 既存のインターフェースを維持

### タスク2: index.jsの修正

**優先度**: 高  
**推定時間**: 1時間

#### チェックリスト

- [x] 既存のコントローラー呼び出し部分の特定
- [x] ControllerManagerのインポート追加
- [x] 既存の呼び出し処理をControllerManagerに置き換え
- [x] 他の処理（weather, typhoon等）の統合検討
- [x] エラーハンドリングの確認
- [x] ログ出力の確認

#### 技術要件

- 既存のFirebase初期化処理を維持
- 既存のエラーハンドリングを維持
- 処理の順序を維持

### タスク3: 動作確認とテスト

**優先度**: 高  
**推定時間**: 2時間

#### チェックリスト

- [x] ControllerManagerの動作確認
  - [x] anneiコントローラーの動作確認
  - [x] ykfコントローラーの動作確認
- [x] データ保存の動作確認
  - [x] firebaseへの保存確認
  - [x] firestoreへの保存確認
- [x] エラーハンドリングの動作確認
- [x] ログ出力の確認
- [x] 既存機能への影響確認
- [x] 処理時間の確認

### タスク3.5: 単体テストの導入

**優先度**: 高  
**推定時間**: 3時間

#### チェックリスト

- [x] Jestライブラリの導入
  - [x] `npm install --save-dev jest`の実行
  - [x] `package.json`にテストスクリプトの追加
  - [x] `jest.config.js`の設定
- [x] ControllerManagerの単体テスト作成
  - [x] `__tests__/controllers.test.js`の作成
  - [x] 全メソッドのテストケース実装
  - [x] 正常実行とエラーハンドリングのテスト
  - [x] モック機能の活用
- [x] テストカバレッジの確認
  - [x] 100%のコードカバレッジ達成
  - [x] 15個のテストケース実装
- [x] テストドキュメントの作成
  - [x] `__tests__/README.md`の作成
  - [x] テスト実行方法の説明
  - [x] テスト構成の説明

#### 技術要件

- 各機能の正常動作確認
- エラー時の適切な処理確認
- パフォーマンスの確認

### タスク4: 他の処理の統合検討

**優先度**: 中  
**推定時間**: 1時間

#### チェックリスト

- [ ] 既存の他の処理の調査
  - [ ] weather処理の調査
  - [ ] typhoon処理の調査
  - [ ] top処理の調査
- [ ] 統合可能性の検討
- [ ] 統合方針の決定
- [ ] 統合実装の計画

#### 技術要件

- 既存処理の構造理解
- 統合による影響の評価
- 段階的統合の計画

### タスク5: 設定駆動型への拡張検討

**優先度**: 低  
**推定時間**: 1時間

#### チェックリスト

- [ ] 設定駆動型アーキテクチャの設計検討
- [ ] 設定ファイルの構造設計
- [ ] 動的ローディングの実装検討
- [ ] 設定変更時の動作確認

#### 技術要件

- 設定ファイルの設計
- 動的ローディングの実装
- 設定変更時の安全性確保

## 実装順序

1. **タスク1**: ControllerManagerクラスの作成（基盤構築）
2. **タスク2**: index.jsの修正（統合実装）
3. **タスク3**: 動作確認とテスト（品質確保）
4. **タスク4**: 他の処理の統合検討（拡張検討）
5. **タスク5**: 設定駆動型への拡張検討（将来拡張）

## 完了条件

- [x] すべてのタスクが完了
- [x] 動作確認が完了
- [x] 既存機能に影響がないことを確認
- [x] 単体テストの導入が完了
- [x] 100%のテストカバレッジを達成
- [x] コードフォーマットが適用済み
- [x] コミットが完了

## 注意事項

- 既存のインターフェースを維持すること
- 段階的に実装し、各段階でテストすること
- エラーハンドリングを適切に実装すること
- ログ出力を統一すること
- テスト導入時のことを考慮した設計にすること
- 単体テストでコードの品質を保つこと
- テストカバレッジを定期的に確認すること

## リスク管理

### リスク

- 既存の処理に影響を与える可能性
- 新しいクラスの学習コスト

### 対策

- 段階的な実装
- 既存の処理を維持しながら統合
- 十分なテストの実施
- ロールバック計画の準備
